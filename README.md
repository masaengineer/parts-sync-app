# Parts Sync | 越境 EC 販売者のための管理会計 SaaS

[![Image from Gyazo](https://i.gyazo.com/3a721fbb896e886a8c4ef51df114f372.jpg)](https://gyazo.com/3a721fbb896e886a8c4ef51df114f372)

**「Parts Sync」** は、越境 EC 販売者の管理会計をサポートする SaaS です。<br>
散らばったデータを少ない工数で一元管理でき、タイムリーな意思決定による売上向上を支援します。
<br><br><br>

## Why - なぜこのツールを開発するのか

### 個人事業時代の課題

輸出 EC 販売に 6 年間従事した経験から、ニッチな市場には SaaS が行き届いていないこと実感していました。労働集約型ビジネスモデルでは、事業主の時間や体力のリソース制限が業績の上限となるケースが数多く存在します。

### データ管理の非効率性

販売戦略の意思決定に必要な商品単位の利益の集計は日次業務として重要ですが、複数のスプレッドシートに分散管理された情報を関数で突合する方法は事業拡大フェーズでは煩雑で非現実的でした。

### 「Parts Sync」の企画

「もっとこんなツールがあればいいのに...」という思いから生まれた「Parts Sync」は、日次作業の業務効率化で事業者のリソースを増やし、迅速な意思決定をサポートして販売機会の向上を支援します。

### ユーザー中心の開発アプローチ

カーパーツを輸出販売する知人の課題に共感し、企画段階から要求をヒアリングしながら仕様を固めました。ユーザーが要望する機能をそのまま開発するのではなく、「**ユーザーが本質的に望んでいる機能は何か**」を意識し、開発コストと要求の充足度を比較検討しながら開発を進めました。
<br><br><br>

## How - どのように課題解決するか

### ペルソナ

年商 3,000 万円〜数億円規模の越境 EC 事業者<br>

#### ユーザーが抱える課題：

- 日々変動する要因（仕入価格、為替、競合他社等）に対応し、競争力のある適正価格で販売するためには、商品単位の原価管理が必須である
- 現状は、仕入代金、各プラットフォームの手数料、国内外の送料、各種外注費、為替情報などが**複数のスプレッドシートで分散管理されている**
- データ更新の漏れや整合性の欠如が頻発してしまっており、**月平均で 30〜50 時間の工数**がかかっている

#### 解決策：

- 最適化されたデータベースを導入し、商品代金、手数料、送料、外注費などの**情報を一元管理**する
- Web アプリで提供し、直感的で複雑性を排除した UI とすることで容易にスタッフ間で情報共有することが可能
- 日次の集計作業にかかる工数を大幅に削減し、**年間 100 万円規模のコストカット**\*を実現<br>（※時間単価 3 千円、月 30 時間削減の場合の試算）

### 業界特化型の機能設計

- 海外販売プラットフォーム eBay との API 連携対応し、**1 時間ごとの自動注文取り込み機能を実装**
- 国際取引にまつわる多通貨（USD, CAD, EUR, GBP, AUD）へ対応

### 新規ユーザーの獲得方法

- **MVP リリース：** テストユーザーによる検証と改善
- **本リリース：** カーパーツ販売者のコミュニティを通じた営業、既存ユーザーによる口コミ紹介
  <br><br><br>

## What - 何を具体として提供するのか <br>

### 主な機能

| カテゴリ         | 機能                                                                                                                                                                                                          |
| ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **売上レポート** | ・eBay API 連携による受注情報自動取得<br>・CSV 取り込み<br>・販売商品一覧と詳細表示<br>・検索/フィルタリング機能<br>・降順昇順並び替え<br>・ページネーション<br>・価格調整メモ<br>・多通貨対応                |
| **月次レポート** | ・年間業績グラフ表示<br>・経費入力/管理                                                                                                                                                                       |
| **全般**         | ・ユーザー登録/認証<br>・Google ログイン<br>・マイページ<br>・ダークモード<br>・オンラインツアーガイド<br>・ローディングアニメーション<br>・デモユーザー体験<br>・静的 OGP<br>・利用規約/プライバシーポリシー |

### 売上レポート関連機能デモ

#### 📥 受注情報自動連携 & CSV インポート機能

[![Image from Gyazo](https://i.gyazo.com/5fb5078493a916a67b9e1dcd23478287.gif)](https://gyazo.com/5fb5078493a916a67b9e1dcd23478287)

<details>
<summary>こだわったポイント（クリックして表示）</summary>
委託先の情報を管理しているスプレッドシートから外注費データをCSV形式で効率的にデータベースへインポートすることができます。<br>

加えて、海外販売プラットフォーム eBay が提供する公式 API との連携により、注文情報は 1 時間ごとに自動で同期されます。この定期的な自動更新処理は、以下の技術構成を採用しています。

- **バックグラウンドジョブ実行:** Sidekiq
- **ジョブキュー管理:** Redis
- **定期実行スケジューリング:** sidekiq-scheduler

当初、この同期処理を Web サーバープロセス内で直接実行（同期的処理）することを試みました。しかし、eBay からのデータ取得・処理には 3〜5 分程度を要するため、Web サーバーのリクエスト処理スレッドを長時間占有してしまい、ユーザーへのレスポンス遅延や、場合によってはリソース枯渇によるサーバーダウンを引き起こしてしまうことがありました。

この問題を解決するため、**Web サーバーの役割（リクエスト処理）と重たいバックグラウンド処理を明確に分離**する方針としました。Sidekiq を導入することで、以下のメリットが得られました。

1.  **非同期実行による UX 向上:** 重たい同期処理をバックグラウンドに移行し、Web サーバーは本来のリクエスト処理に専念できるため、ユーザーは待たされることなく快適にアプリケーションを利用できます。
2.  **堅牢性の向上:** Sidekiq が標準で提供するリトライ機能により、ネットワークや API の一時的なエラーが発生しても自動で再試行され、ジョブの成功率が高まります。
3.  **スケーラビリティの確保:** 将来的に処理対象データやユーザー数が増加した場合でも、Web サーバーとは独立して Sidekiq ワーカーの数を調整することで、柔軟に性能をスケールさせることが可能です。

データ取得期間を限定して同期処理の負荷を下げる代替案も検討しましたが、根本的な課題（Web サーバーのブロッキング、スケーラビリティの限界）の解決には至らないと判断し、長期的な運用性とパフォーマンスを重視して現在の構成を選択しました。<br>

eBayAPI 連携機能のソースコードは[こちら](https://github.com/masaengineer/parts-sync-app/tree/main/app/services/ebay)<br>
CSV インポート機能のソースコードは[こちら](https://github.com/masaengineer/parts-sync-app/tree/main/app/services/csv_importers)

</details>
<br>

---

#### 🔍 フィルタリング機能

[![Image from Gyazo](https://i.gyazo.com/c39aaff5e467c1b1c1f93d1f86959412.gif)](https://gyazo.com/c39aaff5e467c1b1c1f93d1f86959412)

<details>
<summary>こだわったポイント（クリックして表示）</summary>
ユーザーが必要な販売データを迅速に見つけ出せるよう、検索gemであるRansackを導入してフィルタリング機能を実現しました。日付範囲、注文番号、追跡番号、商品SKUなど、複数の条件を組み合わせての絞り込みが可能です。

実装にあたっては、特に以下の点に注力しました。

1.  **パフォーマンス最適化:** 関連テーブル（`order_lines`, `seller_skus`など）を結合した検索では、N+1 問題が発生しやすく、パフォーマンス低下の要因となります。これを回避するため、`includes`メソッドを用いた Eager Loading を適用しました。また、JOIN による重複レコードを防ぐために`.result(distinct: true)`を使用し、データの正確性とパフォーマンスを両立させています。さらに、検索頻度の高いカラムにはデータベースインデックスを適切に設定し、クエリ実行速度を向上させました。
2.  **直感的でシンプルな UI/UX:** 検索条件をユーザーが簡単に指定できるよう、アイコンやプレースホルダーを効果的に配置しました。特に、**日付範囲選択は、ユーザーの主な販路である eBay のインターフェースに可能な限り寄せることで、学習コストを低減**しました。また、一般的な選択肢（「今日」「今週」「先月」など）の場合は即座に検索を実行し、**具体的な日付を指定したい場合にのみ「カスタム」を選択すると、日付入力フィールドが表示される**という設計にすることで、不要な要素を排除し、シンプルで直感的な操作感を実現しました。（Stimulusコントローラーによって制御）

関連コードへのリンクは[こちら](https://github.com/masaengineer/parts-sync-app/blob/main/app/controllers/sales_reports_controller.rb) （サーバーサイドのフィルタリングロジック）<br>
関連コードへのリンクは[こちら](https://github.com/masaengineer/parts-sync-app/blob/main/app/javascript/controllers/date_range_selector_controller.js) （フロントエンドの日付範囲選択 UI）

</details>
<br>

---

#### 📝 オーダー詳細 & 価格調整メモ機能

[![Image from Gyazo](https://i.gyazo.com/86e1fcede5b99059502eb51146b6caf3.gif)](https://gyazo.com/86e1fcede5b99059502eb51146b6caf3)

<details>
<summary>こだわったポイント（クリックして表示）</summary>
商品一覧画面で各注文の詳細確認や価格調整メモの追加を行う際、従来のページ遷移方式ではコンテキストの切り替えが頻繁に発生し、ユーザー体験が低下する懸念がありました。

この課題を解決し、SPA（Single Page Application）のような滑らかなユーザー体験を提供するため、**Hotwire (Turbo Frames/Streams, Stimulus) を採用**しました。

- **シームレスなモーダル表示 (Turbo Frames):** 商品一覧から注文詳細ボタンをクリックすると、ページ全体を再読み込みすることなく、Turbo Frames の遅延読み込み機能を利用してモーダルウィンドウ内に注文詳細コンテンツが表示されます。これにより、ユーザーは一覧画面のコンテキストを維持したまま、素早く詳細情報を確認できます。
- **リアルタイムな UI 更新 (Turbo Streams):** モーダル内で価格調整メモを登録・更新すると、Turbo Streams を通じてサーバーから UI の差分情報が送信され、ページ全体をリロードせずに一覧画面上の価格調整日バッジなどがリアルタイムに更新されます。ユーザーは自身の操作結果を即座に確認でき、ストレスのない操作感を実現しています。
- **洗練されたモーダル制御 (Stimulus & `<dialog>`):** モーダルウィンドウの表示・非表示制御には Stimulus コントローラーと HTML 標準の`<dialog>`要素を組み合わせています。これにより、JavaScript の記述量を最小限に抑えつつ、ESC キー押下やモーダル外クリックによるクローズといった直感的な操作を可能にし、UX を向上させています。

この Hotwire を中心としたアーキテクチャにより、**複雑な JavaScript フレームワークを導入することなく、Rails の生産性を維持したまま、モダンで応答性の高い UI を実現**しました。
<br>

関連コードへのリンクは[こちら](https://github.com/masaengineer/parts-sync-app/blob/main/app/controllers/price_adjustments_controller.rb)

</details>
<br>

---

### 月次レポート関連機能デモ

#### 💰 月次レポート & 経費入力機能

[![Image from Gyazo](https://i.gyazo.com/e428dcbca255851103774bf2cc259800.gif)](https://gyazo.com/e428dcbca255851103774bf2cc259800)

<details>
<summary>こだわったポイント（クリックして表示）</summary>
多くの小規模事業者にとって、厳密な月次決算を毎月行うことは現実的ではないという課題があります。しかし、経営状況をタイムリーに把握するためには、月々の収支を簡易的にでも把握することが不可欠です。

この機能は、**財務会計ではなく管理会計の観点から、迅速な意思決定をサポートすること**を目的としています。具体的には以下の機能を提供します。

- **年間業績グラフ表示:** JavaScript ライブラリ `ApexCharts` を活用し、月ごとの収支推移を直感的なエリアグラフで可視化します。これにより、ユーザーは複雑な数値データを読み解くことなく、**収益と経費のトレンドや推移などを一目で把握**でき、将来の予測や戦略立案に役立てることができます。グラフは Stimulus コントローラー (`chart_controller.js`) を介して制御され、インタラクティブな操作（ツールチップ表示など）も可能です。
- **柔軟な経費入力:** 商品ごとの直接的な利益計算には含めない間接経費（例: 広告宣伝費、事務所家賃など）を手動で入力・管理できます。シンプルで直感的な入力フォーム（Tailwind CSS/DaisyUI）とバリデーションにより、効率的かつ正確なデータ入力を支援します。
- **自動連携による効率化:** 委託先から CSV インポートで取り込んだデータのうち、特定の費用項目（例: オプション手数料）は自動的に経費データとしても登録されます。これにより、二重入力の手間とミスを削減します。

これらの機能を通じて、ユーザーは**煩雑な集計作業なしに月次の経営状況を手軽に把握**し、より迅速かつ適切な意思決定を行うことが可能になります。
<br>

関連コードへのリンクは[こちら](https://github.com/masaengineer/parts-sync-app/tree/main/app/controllers/monthly_reports) （月次レポート関連）<br>
関連コードへのリンクは[こちら](https://github.com/masaengineer/parts-sync-app/blob/main/app/javascript/controllers/chart_controller.js) （グラフ描画）

</details>
<br>

---

### 共通機能デモ

#### 🎯 オンラインツアーガイド機能

[![Image from Gyazo](https://i.gyazo.com/a2b15bd487d7a6200caee2719c018a15.gif)](https://gyazo.com/a2b15bd487d7a6200caee2719c018a15)

<details>
<summary>こだわったポイント（クリックして表示）</summary>
過去に既製品SaaSをを導入した際、多機能であるがゆえに操作が複雑で、長いマニュアルを読んだ時点で利用意欲が削がれてしまった経験があります。優れた機能性があることは前提ですが、toBツールにおいてもtoCに劣らないUIUXを提供することは重要だと考えています。特に **新規ユーザーがスムーズに操作方法を習得し、早期に価値を実感できるようにすることは、ツールの定着と離脱率低下のために非常に重要** だと考えました。

このことから、**ユーザーオンボーディング体験を向上させる**ことを最優先事項の一つとし、軽量な JavaScript ライブラリである`tourguide.js`を導入して、インタラクティブな製品ツアー機能を実装しました。

- **初回利用時のガイダンス:** ユーザーが初めてログインした際にツアーが自動的に開始され、主要な機能（ダークモード切替、フィルター、CSV インポートなど）の場所と目的をステップバイステップで視覚的にハイライトし、簡潔な説明を表示します。これにより、マニュアル不要で基本的な操作を直感的に理解できます。
- **Stimulus 連携:** このツアー機能は Stimulus コントローラー(`tour_controller.js`)内で管理・制御されており、Hotwire ベースのアプリケーション構造とスムーズに連携します。
- **状態の永続化（実装の工夫）:** ツアーを初回訪問ユーザーにのみ表示することが重要でした。当初は `tourguide.js` ライブラリが提供する標準オプションでの制御を試みましたが、意図した通りに動作せず、**2 回目以降の訪問時にもツアーが表示されてしまう問題**が発生しました。そこで、ライブラリの機能に頼るのではなく、**ブラウザの `localStorage` を活用する独自の方法**で実装しました。具体的には、`tour_controller.js` 内でツアー完了を示すフラグを `localStorage` に保存し、コントローラー接続時にこのフラグの有無を確認することで、ツアーの表示を制御しています。この**カスタム実装により、確実に初回訪問時のみツアーを表示**するという要件を満たすことができました。

この機能を通じて、**新規ユーザーの認知負荷を効果的に下げ、操作への心理的ハードルを取り除く**ことで、サービスへのスムーズな導入を促し、結果として**ユーザー定着率の向上やサポート問い合わせの削減**に貢献することを目指しています。
<br>

関連コードへのリンクは[こちら](https://github.com/masaengineer/parts-sync-app/blob/main/app/javascript/controllers/tour_controller.js)

</details>
<br>
<br>

## 使用技術

| カテゴリ           | 技術                                               |
| ------------------ | -------------------------------------------------- |
| **バックエンド**   | Ruby 3.3.6 / Ruby on Rails 7.2.2.1                 |
| **フロントエンド** | Hotwire（Turbo・stimulus）/ Tailwind CSS / DaisyUI |
| **データベース**   | PostgreSQL                                         |
| **インフラ**       | Render                                             |
| **キャッシュ**     | Redis                                              |
| **キューイング**   | Sidekiq / Sidekiq-scheduler                        |
| **テスト**         | RSpec / FactoryBot / Capybara / SimpleCov          |
| **CI/CD**          | GitHub Actions                                     |
| **認証・認可**     | Devise / OmniAuth (Google OAuth2)                  |
| **API 通信**       | Faraday / OAuth2                                   |
| **UI/UX 機能**     | Kaminari（ページネーション）/ Ransack（検索機能）  |
| **国際化**         | Rails-i18n                                         |
| **コンテナ化**     | Docker / Docker Compose                            |
| **セキュリティ**   | Brakeman / Bundler-audit                           |
| **開発ツール**     | Rubocop / Overcommit                               |

<br>

## ER 図

![ER図](https://github.com/user-attachments/assets/334b6fdf-c923-4ef1-95d1-e3e0b94cc6df)

[拡大画像はこちらからご覧いただけます](https://drive.google.com/file/d/1jV2wuRPjwQDTHUo5-jW0aZx39QOyl428/view?usp=sharing)

<br>

## データベース構成

※ ✅ はそのテーブルがどの機能で使用されているかを示しています

| テーブル名        | 説明                                       | **売上レポート** | **月次レポート** |
| ----------------- | ------------------------------------------ | :--------------: | :--------------: |
| users             | 当アプリのユーザー情報を管理               |        ✅        |        ✅        |
| orders            | 注文の基本情報を管理                       |        ✅        |        ✅        |
| order_lines       | 注文の明細情報を管理                       |        ✅        |        ✅        |
| seller_skus       | 販売者側の商品コード情報を管理             |        ✅        |                  |
| manufacturer_skus | メーカー側の商品コード情報を管理           |        ✅        |                  |
| sku_mappings      | メーカーと販売者の商品コードの中間テーブル |        ✅        |                  |
| manufacturers     | メーカー情報を管理                         |        ✅        |                  |
| price_adjustments | 商品価格の調整履歴を管理                   |        ✅        |                  |
| sales             | 売上情報を管理                             |        ✅        |        ✅        |
| procurements      | 仕入れ情報を管理                           |        ✅        |        ✅        |
| shipments         | 配送情報を管理                             |        ✅        |        ✅        |
| payment_fees      | 決済手数料情報を管理                       |        ✅        |        ✅        |
| currencies        | 通貨情報を管理（USD、EUR、GBP など）       |        ✅        |        ✅        |
| expenses          | 月次経費情報を管理                         |                  |        ✅        |
